<html>
<head>
	<title>QueSono.com</title>

	<meta charset='utf-8'>

	<script src="jquery-1.9.1.min.js" type="text/javascript" charset="utf-8"></script>
	<link href='http://fonts.googleapis.com/css?family=Lato:100,400,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="estilos.css">
</head>
<body>
	<div id="header">
		<h1>QueSono.com</h1>
	</div>
	<div class="formularios">
		<form class="acordarAs">
			<h2>Quero acordar as</h2><br>
			<label for="horas">Horas</label>
			<input type="text" id="horas" class="campo-horario" maxlength="2" name="horas" autocomplete="off">
			<span>:</span>
			<label for="minutos">Minutos</label>
			<input type="text" id="minutos" class="campo-horario" maxlength="2" name="minutos" autocomplete="off">
			<input id="btCalcularDormir" class="btn" type="submit" value="Calcular">
			<p class="erros hidden">Digite um horário válido.</p>
		</form>

		<form class="dormirAgora">
			<h2>Se eu for dormir agora...</h2><br>
			<input id="btCalcularAcordar" class="btn" type="submit" value="Zzz">
		</form>
	</div>

	<div class="sugestao hidden">
		<h2></h2>
		<div><span class="6ciclos"></span>, dormindo 6 ciclos</div> ou
		<div><span class="5ciclos"></span>, dormindo 5 ciclos</div> ou
		<div><span class="4ciclos"></span>, dormindo 4 ciclos</div> ou
		<div><span class="3ciclos"></span>, dormindo 3 ciclos</div>
		<input id="btCalcularNovamente" class="btn" type="submit"value="Calcular Novamente">
		<div class="about">
			<p>O <a href="http://quesono.com/">QueSono.com</a> decide o horário contando <a href="http://pt.wikipedia.org/wiki/Sono#O_ciclo_do_sono">Ciclos de Sono</a>.</p>
			<p>Acordar <i>durante</i> um ciclo pode te deixar com <i>sensação de cansaço e irritação</i>, mas acordar <i>entre</i> ciclos lhe dá boas chances de começar o dia <i>bem disposto e alerta.</i></p>
			<p>Uma boa noite de sono é composta de 4 ou 5 ciclos.</p>
		</div>
	</div>

	<script type="text/javascript" charset="utf-8">
		var mostrarSugestao = function() {
			$('.sugestao').fadeIn('slow');
		}

		var mostrarForms = function() {
			$('.formularios').fadeIn('slow');
		}

		var calcularNovamente = function() {
			$('.sugestao').fadeOut('slow', mostrarForms);
		}

		function calculoAcordar(date, ciclos) {
			return new Date(date.getTime() + ciclos*90*60000 + 15*60000);
		}

		function calculoDormir(date, ciclos) {
			return new Date(date.getTime() - ciclos*90*60000 - 15*60000);
		}

		function formatarData(date) {
			var hh = date.getHours();
			var mm = date.getMinutes();
			if (hh < 10) {hh = "0"+hh;}
			if (mm < 10) {mm = "0"+mm;}
			return hh+":"+mm;
		}

		var sugerirHoraDormir = function() {
			var d = new Date();
			d.setUTCDate(d.getUTCDate() + 1);
			d.setHours(parseInt($('#horas').val(), 10));
			d.setMinutes(parseInt($('#minutos').val(), 10));
			$('.sugestao h2').text('Você deveria ir deitar nestes horários:');
			$('.3ciclos').text(formatarData(calculoDormir(d, 3)));
			$('.4ciclos').text(formatarData(calculoDormir(d, 4)));
			$('.5ciclos').text(formatarData(calculoDormir(d, 5)));
			$('.6ciclos').text(formatarData(calculoDormir(d, 6)));
			$('.formularios').fadeOut('slow', mostrarSugestao);
		}

		var sugerirHoraAcordar = function() {
			var d = new Date();
			$('.sugestao h2').text('Você deveria tentar acordar nestes horários:');
			$('.3ciclos').text(formatarData(calculoAcordar(d, 3)));
			$('.4ciclos').text(formatarData(calculoAcordar(d, 4)));
			$('.5ciclos').text(formatarData(calculoAcordar(d, 5)));
			$('.6ciclos').text(formatarData(calculoAcordar(d, 6)));
			$('.formularios').fadeOut('slow', mostrarSugestao);
		}

		$('.acordarAs').submit(function() {
			if ((parseInt($('#horas').val(), 10) >= 0 && parseInt($('#horas').val(), 10) <= 23) &&
				(parseInt($('#minutos').val(), 10) >= 0 && parseInt($('#minutos').val(), 10) <= 59)) {
				sugerirHoraDormir();
			} else {
				$('.erros').slideDown();
			}
			return false;
		});

		$('.dormirAgora').submit(function() {
			sugerirHoraAcordar();
			return false;
		});

		$('.campo-horario').keydown(function() {
			return ( event.ctrlKey || event.altKey
					|| (47<event.keyCode && event.keyCode<58 && event.shiftKey==false)
					|| (95<event.keyCode && event.keyCode<106)
					|| (event.keyCode==8) || (event.keyCode==9)
					|| (event.keyCode>34 && event.keyCode<40)
					|| (event.keyCode==46) || (event.keyCode==13)
					|| (event.keyCode==116) )
		});

		$('.campo-horario').focusin(function() {
			this.value = "";
		});

		$('#horas').keyup(function() {
			if (this.value.length == 2) {
				$('#minutos').focus();
			}
		});

		$('#minutos').keyup(function() {
			if (this.value.length == 2) {
				$('#btCalcularDormir').focus();
			}
		});

		$('#horas').focus();

		$('#btCalcularNovamente').click(function() {
			$('.erros').slideUp();
			calcularNovamente();
		});

	</script>

	<script type="text/javascript">

		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-41378615-1']);
		_gaq.push(['_trackPageview']);

		(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();

	</script>

</body>
</html>